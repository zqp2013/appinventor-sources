<!DOCTYPE html>
<html lang="zh_CN"><!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>使用App Inventor扩展实现多点触控：Scale Detector · App Inventor 2 中文网</title>
    <meta name="keywords" content="App Inventor 2 中文网,参考文档,App Inventor 2中文网,app inventor中文官网,appinventor网页版,appinventor2网站,appinventor官网,APPinventor2网页最新版,app inventor2中文官网,appinventor2 汉化,搭建appinventor2服务器,app inventor2 论坛,AppInventor,App Inventor,App Inventor 2,AI2中文网,AI2 中文网,ai2,少儿编程,青少年编程">
	<meta name="description" content="App Inventor 2 中文网参考文档，使用App Inventor扩展实现多点触控：Scale Detector">
	<meta name="application-name" content="App Inventor 2 中文网"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="/static/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
    <link href="/static/css/fonts.css" rel="stylesheet">
    <link href="/static/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="/static/css/mit_app_inventor.css?1">
    <link rel="stylesheet" type="text/css" href="/static/css/materialdesignicons.min.css">
    <link rel="stylesheet" type="text/css" href="/static/css/docs.css?2">
    <link rel="stylesheet" type="text/css" href="/static/css/prism.css">
    <script src="/static/js/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="/static/js/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="/static/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="/static/js/docs.js?2" crossorigin="anonymous"></script>
    <script src="/static/js/prism.js" crossorigin="anonymous"></script>
    <script type="text/javascript">
     <!--//--><![CDATA[// ><!--

                                   var gotoappinventor = function() {
                                       var referrer = document.location.pathname;
                                       var patt = /.*hour-of-code.*/;
                                       if (referrer.match(patt)) {
                                           window.open("http://code.appinventor.mit.edu/", "new");
                                       } else {
                                           window.open("https://www.fun123.cn/", "new");
                                       }
                                   }
     //--><!]]>
    </script><!-- Hotjar Tracking Code for https://www.fun123.cn -->
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:3792684,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
</head>
<body class="mit_app_inventor"><nav class="navbar navbar-expand-xl navbar-light">
    <a class="navbar-brand" href="https://www.fun123.cn/">
	<img src="/static/images/logo.png" alt="Logo" style="height:72px;">
    </a>
    <button type="button" class="btn create-btn" style="margin-right: 20px;" onclick="gotoappinventor();">创建 Apps</button>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarContent"
            aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle Navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarContent">
	<ul class="navbar-nav" style="margin-left: auto;">
		<li class="nav-item">
		<a class="nav-link" href="https://www.fun123.cn/reference/">首页</a>
		</li>
	    <li class="nav-item dropdown">
		<a class="nav-link" href="https://www.fun123.cn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		    关于我们
		</a>
		<div class="dropdown-menu">
		    <a class="dropdown-item" href="https://www.fun123.cn/reference/info/about-us.html?f=ref">关于我们</a>
			<a class="dropdown-item" href="https://www.fun123.cn/reference/info/ReleaseNotes.html?f=ref" target="_blank">发布日志</a>
			<a class="dropdown-item" href="https://www.fun123.cn/Ya_tos_form.html?f=ref" target="_blank">服务条款</a>
		</div>
	    </li>
	    <li class="nav-item dropdown">
		<a class="nav-link" href="https://www.fun123.cn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		    教育
		</a>
		<div class="dropdown-menu">
			<a class="dropdown-item" href="https://www.fun123.cn/reference/info/?f=ref#AppEntry" target="_blank">项目指南</a>
		    <a class="dropdown-item" href="https://bbs.tsingfun.com/forum-147-1.html?f=ref" target="_blank">中文论坛</a>
		    <a class="dropdown-item" href="https://www.fun123.cn/reference/tutorials?f=ref">中文教程</a>
		</div>
	    </li>
		<li class="nav-item dropdown">
		<a class="nav-link" href="https://www.fun123.cn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
			反馈
		</a>
		<div class="dropdown-menu">
			<a class="dropdown-item" href="https://support.qq.com/products/514085" target="_blank">我要反馈</a>
		</div>
		</li>
    </ul>
        <div style="display: inline-flex;margin-left:auto;margin-right:0">
				<script>
					var _hmt = _hmt || [];
					(function() {
					  var hm = document.createElement("script");
					  hm.src = "https://hm.baidu.com/hm.js?8d287b854d737bdc880e8ddeac1b309d";
					  var s = document.getElementsByTagName("script")[0]; 
					  s.parentNode.insertBefore(hm, s);
					})();
				</script>
        </div>
	<!-- <form class="form-inline" action="/action_page.php">
	     <div class="form-group has-search">
	     <span class="fa fa-search form-control-feedback"></span>
	     <input type="text" class="form-control" placeholder="Search">
	     </div>
	     </form> -->
    </div>
	<div class="collapse navbar-collapse">
		<img src="/static/images/hello.png" alt="你好">
	</div>
</nav>
<div class="default-page">
            <div class="header">
	        <h1 class="font-weight-bold text-center offset-xl-2 col-xl-8">使用App Inventor扩展实现多点触控：Scale Detector</h1>
            </div>
            <div class="container-fluid">
                <article class="documentation">
<p><a href="index.html">« 返回首页</a></p>

<hr />
<p>草稿（9 月 13 日）：构建扩展需要 App Inventor Extensions 功能，该功能尚未合并到 App Inventor 版本中。 但是你可以使用我们的扩展测试服务器尝试下面描述的一些步骤：</p>

<ol>
  <li>演示打包的应用程序 ScaleGestureDemo.apk 可以像任何 apk 文件一样加载和运行。</li>
  <li>你可以按照下面的第 1 部分加载提供的源文件 ScaleGestureDemo.aia 来构建演示源应用程序。 要构建应用程序，你需要使用位于 <a href="http://extension-test.appinventor.mit.edu">http://extension-test.appinventor.mit.edu</a> 的 App Inventor 测试服务器。 你还需要使用与该实例对应的 AI Companion。 连接到服务器后，查看“帮助”-&gt;“伴侣信息”以下载该伴侣。 当你切换回普通的AI2服务器时，你需要重新安装普通的伴侣。</li>
  <li>你可以使用扩展测试服务器按照下面第 2 部分中的描述实施 ScaleDetector.aix 扩展。</li>
</ol>

<p>请记住，扩展机制仍然不稳定并且正在开发中。 随着系统的发展，你在步骤 (2) 和 (3) 中构建的任何 aia 文件可能需要重新构建。</p>

<hr />

<p>内容</p>

<ol>
  <li><a href="#demonstration">多点触控演示应用</a></li>
  <li><a href="#extension">实现ScaleDetector扩展</a></li>
</ol>

<p>App Inventor 没有内置多点触控功能。添加多点触控是一个普遍的要求，麻省理工学院最终可能会将其包含在系统中。 同时，这篇笔记说明了如何使用 App Inventor 扩展来实现一个缩放检测器组件，人们可以使用它来创建对捏合和缩放手势做出反应的应用程序。</p>

<p>该说明在两个方面很有趣：</p>

<p>对于 App Inventor 用户，它提供了一个可以共享和合并到项目中的功能性 ScaleDetector 组件。
对于 App Inventor 开发人员，可以作为模板来创建新的 App Inventor 组件，这些组件可以实现其他 Android 手势检测器。</p>

<h2 id="demonstration">1、多点触控演示应用</h2>

<p>ScaleGestureDemo 是缩放手势的简单演示，其中两根手指靠得更近或更远以表示展开或收缩。 你可以从这里下载打包的应用程序并使用它。 中间有一个球的画布。 用两根手指捏住球会缩小球，张开手指会扩大球。 此外，用一根手指轻敲画布会将球移动到轻敲的位置。</p>

<p><img src="images/extensionsMultitouch1.png" alt="" /></p>

<p><img src="images/extensionsMultitouch2.jpg" alt="" /></p>

<p>如上所示，blocks 程序使用了一个 ScaleDetector 组件，其关键特性是一个 when ScaleDetector.Scale 事件处理程序。 除了 ScaleDetector1 之外，还有 Canvas1，其中包含 Ball1 精灵和 Label1。</p>

<p>使用数字 scaleFactor 调用 ScaleDetector1.Scale 事件处理程序。 当 scaleFactor 大于 1 时，表示手指正在分开。 在这种情况下，程序将球的半径增加 3，最多为画布宽度的一半。 当 scaleFactor 小于 1 时，手指会靠得更近，程序会将球的大小缩小 3，至少缩小到 5。程序还会设置标签文本以显示球的当前大小。</p>

<p>应用程序的另一个关键部分是在应用程序启动时调用 ScaleDetector.AddHandlerToCanvas 方法。 这告诉比例检测器在指示的画布上侦听比例手势。 请注意，此处的输入是 Canvas1 组件本身，它是从 Canvas1 抽屉底部的“组件”块中获取的。 （这里插入 myCanvas 插槽的块必须是 Canvas 组件块，否则应用程序会崩溃。）</p>

<p>最后，还有一个 Canvas1.Touch 事件处理程序，它在 Canvas 被触摸（用一根手指）时移动球。 总之，画布对两种手势敏感：触摸和缩放。 Touch 内置于 Canvas 中：事件处理程序是 Canvas1 的一个块。 比例由 ScaleDetector 添加，事件处理程序是 ScaleDetector1 的块。</p>

<p>你可以使用 ScaleDetector 扩展来创建你自己的响应缩放手势的多点触控应用程序。 你需要导入 ScaleDetector.aix 扩展文件，如 App Inventor 扩展中所述，然后使用 ScaleDetector 组件进行构建，就像使用任何组件一样。 ScaleDetector.aix 扩展可在此处获得：</p>

<p><a href="https://github.com/mit-cml/extensions/blob/gh-pages/data/extensions/edu.mit.appinventor.ScaleDetector.aix">edu.mit.appinventor.ScaleDetector.aix</a></p>

<p>我们还为 ScaleGestureDemo 应用程序提供了完整的 aia 源代码，以节省你从头开始组装积木的工作量。 如果将此 aia 文件加载到 App Inventor 中，则无需单独安装 ScaleDetector.aix 扩展。 该扩展包含在源代码中。 通常，项目源文件包括项目使用的任何扩展名。</p>

<h2 id="extension">2、实现ScaleDetector扩展</h2>

<p>上一节展示了如何使用提供的 ScaleDetector 扩展 aix 文件创建应用程序。 你还可以练习实现扩展本身。</p>

<p>规模检测或扩展作为 Java 代码实现，编译和处理以生成 aix 文件，如 App Inventor 扩展中所述。 Java 代码文件 ScaleDetector.java 可在此处获得：</p>

<p><a href="https://github.com/mit-cml/extensions/blob/gh-pages/data/sources/edu.mit.appinventor.ScaleDetector_src.zip">edu.mit.appinventor.ScaleDetector_src.zip</a></p>

<p>这段扩展代码只不过是 Android SDK 的 ScaleGestureDetector 和 SimpleOnScaleGestureListener 类的接口，它们完成了实际分析原始 Android 运动事件的所有工作。</p>

<p>在我们的实现中，我们为 ScaleDetector 组件创建了一个 onScale 块，它将 scaleFactor 作为回调参数，让 App Inventor 用户为缩放事件创建处理程序，如上面的 ScaleGestureDemo 所示：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SimpleEvent</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">Scale</span><span class="o">(</span><span class="kt">double</span> <span class="n">scaleFactor</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">EventDispatcher</span><span class="o">.</span><span class="na">dispatchEvent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">"Scale"</span><span class="o">,</span> <span class="n">scaleFactor</span><span class="o">);</span>

<span class="o">}</span>
</code></pre></div></div>

<p>我们还创建了 SimpleOnScaleGestureListener 的适当子类。 这将覆盖 onScale 的默认事件处理，以调用块 Scale 事件处理程序：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyOnScaleGestureListener</span> <span class="kd">extends</span> <span class="n">SimpleOnScaleGestureListener</span> <span class="o">{</span>
    <span class="c1">// 我们覆盖普通 SimpleOnScaleGestureListener 的事件处理</span>
    <span class="c1">// 在这种情况下，使 onScale 事件调用组件的 Scale 事件处理程序，其</span>
    <span class="c1">// 行为可以由 When Scale 块定义。</span>
   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onScale</span><span class="o">(</span><span class="n">ScaleGestureDetector</span> <span class="n">detector</span><span class="o">)</span> <span class="o">{</span>              
         <span class="kt">float</span> <span class="n">scaleFactor</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="na">getScaleFactor</span><span class="o">();</span>
        <span class="c1">//  Log.i("Scale", "onScale was signaled, scale factor = " + scaleFactor);</span>
         <span class="n">Scale</span><span class="o">((</span><span class="kt">double</span><span class="o">)</span> <span class="n">scaleFactor</span><span class="o">);</span>
         <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
   <span class="o">}</span>
 <span class="o">}</span>
</code></pre></div></div>

<p>接下来，我们创建新的手势检测器类，它扩展了 SDK ScaleGestureDetector，用于添加到 Canvas。 它是从一个手势侦听器构建的，以及一个应该发生侦听的上下文：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExtensionScaleDetector</span> <span class="kd">extends</span> <span class="n">ScaleGestureDetector</span>
         <span class="kd">implements</span> <span class="n">Canvas</span><span class="o">.</span><span class="na">ExtensionGestureDetector</span> <span class="o">{</span>
   <span class="kd">public</span> <span class="nf">ExtensionScaleDetector</span><span class="o">(</span><span class="n">Context</span> <span class="n">c</span><span class="o">,</span> <span class="n">OnScaleGestureListener</span> <span class="n">l</span> <span class="o">)</span> <span class="o">{</span>
         <span class="kd">super</span><span class="o">(</span><span class="n">c</span><span class="o">,</span><span class="n">l</span><span class="o">);</span>
   <span class="o">}</span>
 <span class="o">}</span>
</code></pre></div></div>

<p>这里的一个关键步骤是将类声明为实现 Canvas.ExtensionDetector。 Canvas.ExtensionDetector 是 Canvas 提供的接口。 每个 Canvas 都有一个手势处理器列表，在触摸 Canvas 时调用这些处理器。 可以使用 Canvas.registerCustomGestureDetector 将实现 ExtensionDetector 接口的类添加到 Canvas 的列表中。 实现接口唯一需要的是实现类提供一个带有签名的方法</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">boolean</span> <span class="nf">onTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">event</span><span class="o">);</span>
</code></pre></div></div>

<p>在我们的例子中，我们的 ExtensionScaleDetector 类扩展了 ScaleGestureDetector，这一事实自动满足了这一要求。</p>

<p>最后，我们实现将手势检测器添加到指定 Canvas 的块：</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SimpleFunction</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">AddHanderToCanvas</span><span class="o">(</span><span class="n">Canvas</span> <span class="n">myCanvas</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">myCanvas</span> <span class="o">=</span> <span class="n">myCanvas</span><span class="o">;</span>
        <span class="n">ExtensionScaleDetector</span> <span class="n">myDetector</span> <span class="o">=</span>
            <span class="k">new</span> <span class="nf">ExtensionScaleDetector</span><span class="o">(</span><span class="n">myCanvas</span><span class="o">.</span><span class="na">getContext</span><span class="o">(),</span> <span class="k">new</span> <span class="n">MyOnScaleGestureListener</span><span class="o">());</span>
        <span class="n">myCanvas</span><span class="o">.</span><span class="na">registerCustomGestureDetector</span><span class="o">(</span><span class="n">myDetector</span><span class="o">);</span>
  <span class="o">}</span>
</code></pre></div></div>

<p>ExtensionScale 的构造函数的参数是上面实现的手势监听器，以及 Canvas 的上下文，这是监听应该发生的上下文。</p>

<p>你可以构建以类似方式响应其他多点触控手势的其他扩展，前提是你可以找到或创建适当的手势侦听器。</p>

<p><a href="https://docs.google.com/document/d/1UwpTqLqNOPJxOlBxQSIVTOH548lbQhmpdj-MrUMToA4/edit">点此查看英文原版</a></p>

</article>

            </div>
            <div class="cndns-right">
	<div class="cndns-right-menu menu-common" style="display:none" id="float_menu_btn">
		<a href="javascript:HideORDispMenu();" class="cndns-right-btn">
			<span class="fa fa-bars"></span>
			<p>
				切换<br />
				目录
			</p>
		</a>
	</div>
	<div class="cndns-right-menu menu-common">
		<a href="javascript:" class="cndns-right-btn">
			<span class="fa fa-qrcode"></span>
			<p>
				关注<br />
				我们
			</p>
		</a>
		<div class="cndns-right-box">
			<div class="box-border">
				<div class="sev-t">
					<img src="/static/images/weixin.jpg" />
					<i>关注我，不迷路</i>
				</div>
				<span class="arrow-right"></span>
			</div>
		</div>
	</div>
	<div class="cndns-right-menu menu-common">
		<a href="javascript:" class="cndns-right-btn">
			<span class="fa fa-wechat"></span>
			<p>
				技术<br />
				支持
			</p>
		</a>
		<div class="cndns-right-box">
			<div class="box-border">
				<div class="sev-t">
					<img src="/static/images/weixin.png" />
					<i>有技术难题，加我！</i>
				</div>
				<span class="arrow-right"></span>
			</div>
		</div>
	</div>
	<div class="cndns-right-menu menu-top" style="display:none" id="float_scrolltop">
		<a href="javascript:scroll2Top();" class="cndns-right-btn">
			<span class="fa fa-angle-up"></span>
			<i>顶部</i>
		</a>
	</div>
</div>

<div class="footer background-green">
    <div class="row container">
	<div class="col-xl-3">
	    <h4>App Inventor 2 中文网</h4>
	    <!-- <form class="form-inline" action="/action_page.php">
		 <div class="form-group has-search">
		 <span class="fa fa-search form-control-feedback"></span>
		 <input type="text" class="form-control" placeholder="Search">
		 </div>
		 </form> -->
	</div>
	<div class="col-xl-6 legal text-center">
	    <ul>
		<li>
		    <a href="https://www.fun123.cn" class="btn btn-link" role="button" target="_blank">© 2023 跟着学（上海）教育科技有限公司</a>
		</li>
		<li>
		    <a class="btn btn-link" role="button">版权所有，未经书面许可，不得转载或使用</a>
		</li>
		<li>
		    <a href="https://www.fun123.cn/Ya_tos_form.html?f=refb"
                       target="_blank" class="btn btn-link" role="button">隐私策略和使用条款</a>
		</li>
	    </ul>
	</div>
	<div class="col-xl-3 links">
		<a href="https://bbs.tsingfun.com/forum-147-1.html" target="_blank">技术支持</a><br>
		<a href="mailto:service@fun123.cn">service@fun123.cn</a>
	</div>

    </div>
</div>

</div>
    </body>
</html>
