<!DOCTYPE html>
<html lang="zh_CN"><!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>使用 XML 和 Web 服务 · App Inventor 2 中文网</title>
    <meta name="keywords" content="App Inventor 2 中文网,参考文档,App Inventor 2中文网,app inventor中文官网,appinventor网页版,appinventor2网站,appinventor官网,APPinventor2网页最新版,app inventor2中文官网,appinventor2 汉化,搭建appinventor2服务器,app inventor2 论坛,AppInventor,App Inventor,App Inventor 2,AI2中文网,AI2 中文网,ai2,少儿编程,青少年编程">
	<meta name="description" content="App Inventor 2 中文网参考文档，App Inventor 2 使用 XML 和 Web 服务">
	<meta name="application-name" content="App Inventor 2 中文网"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="/static/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
    <link href="/static/css/fonts.css" rel="stylesheet">
    <link href="/static/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="/static/css/mit_app_inventor.css?1">
    <link rel="stylesheet" type="text/css" href="/static/css/materialdesignicons.min.css">
    <link rel="stylesheet" type="text/css" href="/static/css/docs.css?2">
    <link rel="stylesheet" type="text/css" href="/static/css/prism.css">
    <script src="/static/js/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="/static/js/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="/static/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="/static/js/docs.js?2" crossorigin="anonymous"></script>
    <script src="/static/js/prism.js" crossorigin="anonymous"></script>
    <script type="text/javascript">
     <!--//--><![CDATA[// ><!--

                                   var gotoappinventor = function() {
                                       var referrer = document.location.pathname;
                                       var patt = /.*hour-of-code.*/;
                                       if (referrer.match(patt)) {
                                           window.open("http://code.appinventor.mit.edu/", "new");
                                       } else {
                                           window.open("https://www.fun123.cn/", "new");
                                       }
                                   }
     //--><!]]>
    </script><!-- Hotjar Tracking Code for https://www.fun123.cn -->
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:3792684,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
</head>
<body class="mit_app_inventor"><nav class="navbar navbar-expand-xl navbar-light">
    <a class="navbar-brand" href="https://www.fun123.cn/">
	<img src="/static/images/logo.png" alt="Logo" style="height:72px;">
    </a>
    <button type="button" class="btn create-btn" style="margin-right: 20px;" onclick="gotoappinventor();">创建 Apps</button>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarContent"
            aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle Navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarContent">
	<ul class="navbar-nav" style="margin-left: auto;">
		<li class="nav-item">
		<a class="nav-link" href="https://www.fun123.cn/reference/">首页</a>
		</li>
	    <li class="nav-item dropdown">
		<a class="nav-link" href="https://www.fun123.cn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		    关于我们
		</a>
		<div class="dropdown-menu">
		    <a class="dropdown-item" href="https://www.fun123.cn/reference/info/about-us.html?f=ref">关于我们</a>
			<a class="dropdown-item" href="https://www.fun123.cn/reference/info/ReleaseNotes.html?f=ref" target="_blank">发布日志</a>
			<a class="dropdown-item" href="https://www.fun123.cn/Ya_tos_form.html?f=ref" target="_blank">服务条款</a>
		</div>
	    </li>
	    <li class="nav-item dropdown">
		<a class="nav-link" href="https://www.fun123.cn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		    教育
		</a>
		<div class="dropdown-menu">
			<a class="dropdown-item" href="https://www.fun123.cn/reference/info/?f=ref#AppEntry" target="_blank">项目指南</a>
		    <a class="dropdown-item" href="https://bbs.tsingfun.com/forum-147-1.html?f=ref" target="_blank">中文论坛</a>
		    <a class="dropdown-item" href="https://www.fun123.cn/reference/tutorials?f=ref">中文教程</a>
		</div>
	    </li>
		<li class="nav-item dropdown">
		<a class="nav-link" href="https://www.fun123.cn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
			反馈
		</a>
		<div class="dropdown-menu">
			<a class="dropdown-item" href="https://support.qq.com/products/514085" target="_blank">我要反馈</a>
		</div>
		</li>
    </ul>
        <div style="display: inline-flex;margin-left:auto;margin-right:0">
				<script>
					var _hmt = _hmt || [];
					(function() {
					  var hm = document.createElement("script");
					  hm.src = "https://hm.baidu.com/hm.js?8d287b854d737bdc880e8ddeac1b309d";
					  var s = document.getElementsByTagName("script")[0]; 
					  s.parentNode.insertBefore(hm, s);
					})();
				</script>
        </div>
	<!-- <form class="form-inline" action="/action_page.php">
	     <div class="form-group has-search">
	     <span class="fa fa-search form-control-feedback"></span>
	     <input type="text" class="form-control" placeholder="Search">
	     </div>
	     </form> -->
    </div>
	<div class="collapse navbar-collapse">
		<img src="/static/images/hello.png" alt="你好">
	</div>
</nav>
<div class="default-page">
            <div class="header">
	        <h1 class="font-weight-bold text-center offset-xl-2 col-xl-8">使用 XML 和 Web 服务</h1>
            </div>
            <div class="container-fluid">
                <article class="documentation">
<p><a href="index.html">« 返回首页</a></p>

<h2 id="使用-xml-和-web-服务">使用 XML 和 Web 服务</h2>

<p>The Web.XMLTextDecode takes a given XML text string and decodes it to produce a list.   If the text is not well-formed XML, it will signal an error and return the empty list.</p>

<p>The list returned by XMLTextDecode contains one pair for each top-level tag-delimited structure in the input string.   For example, decoding</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;hello&gt;</span>123<span class="nt">&lt;/hello&gt;</span>
</code></pre></div></div>

<p>returns the list of one pair (hello, 123) and decoding</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;hello&gt;</span>123<span class="nt">&lt;/hello&gt;</span>

<span class="nt">&lt;goodbye&gt;</span>456<span class="nt">&lt;/goodbye&gt;</span>
</code></pre></div></div>

<p>returns the list of two pairs (hello, 123) and (goodbye, 456).</p>

<p>For each pair, the first element is the tag, and the second element is the decoding of the string delimited by the tag.  Here are some examples:</p>

<p>Decoding</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;hello&gt;</span>everybody<span class="nt">&lt;/hello&gt;</span>
</code></pre></div></div>

<p>produces the pair (hello, everybody).</p>

<p>Decoding</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;hello&gt;</span>everybody out there<span class="nt">&lt;/hello&gt;</span>
</code></pre></div></div>

<p>produces the pair (hello, everybody out there), where the second item in the pair is a string “everybody out there” that contains spaces .</p>

<p>Decoding</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;greet&gt;</span>

   <span class="nt">&lt;goodbye&gt;</span>nobody<span class="nt">&lt;/goodbye&gt;</span>

   <span class="nt">&lt;hello&gt;</span>everybody<span class="nt">&lt;/hello&gt;</span>

<span class="nt">&lt;/greet&gt;</span>
</code></pre></div></div>

<p>produces the pair (greet, data) where data is a list containing the pair (goodbye, nobody) and the pair (hello, everybody).   The pairs in a decoding are listed in alphabetical order by tag, regardless of their order in the original input sequence.  Each pair consists of the tag, together with the decoding of the data delimited by that tag.   As this example shows, if the items delimited by the tag are themselves XML-delimited text, then the data items for the pairs in the decoding will themselves be lists of pairs.</p>

<p>If the XML string contains both delimited and non-delimited items, then the non-delimited items will all be extracted processed as if they had been a sequence of items delimited by the tag “content”.  For example, decoding</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;greet&gt;</span>

     <span class="nt">&lt;goodbye&gt;</span>nobody<span class="nt">&lt;/goodbye&gt;</span>

     happy

     <span class="nt">&lt;hello&gt;</span>everybody<span class="nt">&lt;/hello&gt;</span>

     sad

<span class="nt">&lt;/greet&gt;</span>
</code></pre></div></div>

<p>will produce a pair just as in the last example above, except that the list of pairs will now include an additional pair (content, (happy sad)) where the second item in the additional pair is the list of strings “happy” and “sad”.</p>

<p>It is also possible that the XML contains elements with attributes, for example:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="nt">&lt;person</span> <span class="na">firstname=</span><span class="s">"John"</span> <span class="na">lastname=</span><span class="s">"Doe"</span><span class="nt">&gt;&lt;/person&gt;</span>
</code></pre></div></div>

<p>Decoded, this will look like ((person ((firstname ”John”) (lastname ”Doe”)))).</p>

<h3 id="xml-and-web-services">XML and Web services</h3>

<p>Many Web services have APIs that return information in XML format.  To process these with App Inventor, you can decode the result with XMLTextDecode.  Then extract the desired items from the resulting list, using the list operation block  lookup in pairs.  Here’s an example.</p>

<p>Unfortunately, the example below does not work anymore, because Underground Weather is discontinued. As an alternative, Openweathermap could be used: https://openweathermap.org/.</p>

<p>Weather Underground’s Weather API is a free service that you can query for weather information at specified locations.   We can use this service use this together with the App Inventor Web component to retrieve the Fahrenheit temperature in San Francisco.   We start by getting the complete weather for San Francisco, by doing an HTTP Get with the URL:</p>

<p>http://api.wunderground.com/api/YOUR KEY/conditions/q/CA/San_Francisco.xml</p>

<p>You’ll need to replace the string YOUR KEY by an actual key that you can get by registering with the Weather Underground Weather API service.  See the Weather API documentation for information on how to do this.</p>

<p>Note: The Weather API can also return information on in JSON rather than XML, which App Inventor can manipulate using the Web.JsonTextDecode block, leading to an example similar to the one described here, but done using JSON.</p>

<p>Here are the blocks that perform this GET when a button (GetWeatherButton) is pressed.   When the result is returned, we set the text of the label SFTemp to the temperature.</p>

<p><img src="images/xml-image1.png" alt="" /></p>

<p>The main work is done by the procedure extractTemperature.  It processes the response from the Web service to extract the Temperature.   The Web service response is a complex XML structure like this:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;response&gt;</span>

 <span class="nt">&lt;version&gt;</span>0.1<span class="nt">&lt;/version&gt;</span>

 <span class="nt">&lt;termsofService&gt;</span>...<span class="nt">&lt;/termsofService&gt;</span>

 <span class="nt">&lt;features&gt;&lt;feature&gt;</span>conditions<span class="nt">&lt;/feature&gt;&lt;/features&gt;</span>

 <span class="nt">&lt;current_observation&gt;</span>

        ...

        <span class="nt">&lt;temp_f&gt;</span>68.2<span class="nt">&lt;/temp_f&gt;</span>

        <span class="nt">&lt;temp_c&gt;</span>20.1<span class="nt">&lt;/temp_c&gt;</span>

        <span class="nt">&lt;relative_humidity&gt;</span>66%<span class="nt">&lt;/relative_humidity&gt;</span>

      <span class="nt">&lt;UV&gt;</span>1<span class="nt">&lt;/UV&gt;</span>

        ...

 <span class="nt">&lt;/current_observation&gt;</span>

<span class="nt">&lt;/response&gt;</span>
</code></pre></div></div>

<p>(There’s a lot more in the structure that is not shown here, as indicated by the … .)</p>

<p>Decoding this with XMLTextDecode produces a list, where the sublists correspond to the delimited XML substrings.  Observe that the order of the sublists does not match the order in the XML text: it is now alphabetical by tag (case-sensitive order):</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>((response

   ((current_observation

      ((UV 1)

        ...

       (relative_humidity 66%)

       (temp_c 20.1)

       (temp_f 68.2)

        ...)

      ))

    (termsofService ...)

    (version 0.1)))
</code></pre></div></div>

<p>We can extract the temperature in the following steps:</p>

<ul>
  <li>begin with the list above, which is a list of pairs (with only one pair)</li>
  <li>extract the data that is tagged with “response” to get the list of pairs ((current_observation) …)</li>
  <li>from the result, extract the data that is tagged with “current_observation” to obtain another list of pairs ((UV 1) … (temp_c 20.1) (temp_f 68.2) …)</li>
  <li>from that result, extract the data that is tagged with “temp_f”</li>
  <li>the final result is the temperature</li>
</ul>

<p><img src="images/xml-image2.png" alt="" /></p>

<p>Notice how this procedure is structured with successive calls to lookup in pairs, each lookup operating on the result of the previous lookup.  The procedure is written in the way it is, with successive assignments to the local variable answer, to make it convenient in App Inventor  to build up the procedure step by step, starting with the [do …] block empty, add the next</p>

<p>[set answer …]  block at each step, while checking the result at each step.  Constructing procedures step by step, while checking intermediate results, is a good idea when extracting data from complex XML structures, where there might be many steps and it’s hard to get a procedure correct on the first try.</p>

</article>

            </div>
            <div class="cndns-right">
	<div class="cndns-right-menu menu-common" style="display:none" id="float_menu_btn">
		<a href="javascript:HideORDispMenu();" class="cndns-right-btn">
			<span class="fa fa-bars"></span>
			<p>
				切换<br />
				目录
			</p>
		</a>
	</div>
	<div class="cndns-right-menu menu-common">
		<a href="javascript:" class="cndns-right-btn">
			<span class="fa fa-qrcode"></span>
			<p>
				关注<br />
				我们
			</p>
		</a>
		<div class="cndns-right-box">
			<div class="box-border">
				<div class="sev-t">
					<img src="/static/images/weixin.jpg" />
					<i>关注我，不迷路</i>
				</div>
				<span class="arrow-right"></span>
			</div>
		</div>
	</div>
	<div class="cndns-right-menu menu-common">
		<a href="javascript:" class="cndns-right-btn">
			<span class="fa fa-wechat"></span>
			<p>
				技术<br />
				支持
			</p>
		</a>
		<div class="cndns-right-box">
			<div class="box-border">
				<div class="sev-t">
					<img src="/static/images/weixin.png" />
					<i>有技术难题，加我！</i>
				</div>
				<span class="arrow-right"></span>
			</div>
		</div>
	</div>
	<div class="cndns-right-menu menu-top" style="display:none" id="float_scrolltop">
		<a href="javascript:scroll2Top();" class="cndns-right-btn">
			<span class="fa fa-angle-up"></span>
			<i>顶部</i>
		</a>
	</div>
</div>

<div class="footer background-green">
    <div class="row container">
	<div class="col-xl-3">
	    <h4>App Inventor 2 中文网</h4>
	    <!-- <form class="form-inline" action="/action_page.php">
		 <div class="form-group has-search">
		 <span class="fa fa-search form-control-feedback"></span>
		 <input type="text" class="form-control" placeholder="Search">
		 </div>
		 </form> -->
	</div>
	<div class="col-xl-6 legal text-center">
	    <ul>
		<li>
		    <a href="https://www.fun123.cn" class="btn btn-link" role="button" target="_blank">© 2023 跟着学（上海）教育科技有限公司</a>
		</li>
		<li>
		    <a class="btn btn-link" role="button">版权所有，未经书面许可，不得转载或使用</a>
		</li>
		<li>
		    <a href="https://www.fun123.cn/Ya_tos_form.html?f=refb"
                       target="_blank" class="btn btn-link" role="button">隐私策略和使用条款</a>
		</li>
	    </ul>
	</div>
	<div class="col-xl-3 links">
		<a href="https://bbs.tsingfun.com/forum-147-1.html" target="_blank">技术支持</a><br>
		<a href="mailto:service@fun123.cn">service@fun123.cn</a>
	</div>

    </div>
</div>

</div>
    </body>
</html>
