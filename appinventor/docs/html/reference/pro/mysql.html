<!DOCTYPE html>
<html lang="zh_CN"><!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>App Inventor 2 如何连接MySQL数据库（阿里云数据库） · App Inventor 2 中文网</title>
    <meta name="keywords" content="App Inventor 2 中文网,参考文档,App Inventor 2中文网,app inventor中文官网,appinventor网页版,appinventor2网站,appinventor官网,APPinventor2网页最新版,app inventor2中文官网,appinventor2 汉化,搭建appinventor2服务器,app inventor2 论坛,AppInventor,App Inventor,App Inventor 2,AI2中文网,AI2 中文网,ai2,少儿编程,青少年编程">
	<meta name="description" content="App Inventor 2 中文网参考文档，App Inventor 2 如何连接MySQL数据库（阿里云数据库）,MySQL,数据库。">
	<meta name="application-name" content="App Inventor 2 中文网"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="/static/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
    <link href="/static/css/fonts.css" rel="stylesheet">
    <link href="/static/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="/static/css/mit_app_inventor.css?1">
    <link rel="stylesheet" type="text/css" href="/static/css/materialdesignicons.min.css">
    <link rel="stylesheet" type="text/css" href="/static/css/docs.css?2">
    <link rel="stylesheet" type="text/css" href="/static/css/prism.css">
    <script src="/static/js/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="/static/js/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="/static/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="/static/js/docs.js?2" crossorigin="anonymous"></script>
    <script src="/static/js/prism.js" crossorigin="anonymous"></script>
    <script type="text/javascript">
     <!--//--><![CDATA[// ><!--

                                   var gotoappinventor = function() {
                                       var referrer = document.location.pathname;
                                       var patt = /.*hour-of-code.*/;
                                       if (referrer.match(patt)) {
                                           window.open("http://code.appinventor.mit.edu/", "new");
                                       } else {
                                           window.open("https://www.fun123.cn/", "new");
                                       }
                                   }
     //--><!]]>
    </script><!-- Hotjar Tracking Code for https://www.fun123.cn -->
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:3792684,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
</head>
<body class="mit_app_inventor"><nav class="navbar navbar-expand-xl navbar-light">
    <a class="navbar-brand" href="https://www.fun123.cn/">
	<img src="/static/images/logo.png" alt="Logo" style="height:72px;">
    </a>
    <button type="button" class="btn create-btn" style="margin-right: 20px;" onclick="gotoappinventor();">创建 Apps</button>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarContent"
            aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle Navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarContent">
	<ul class="navbar-nav" style="margin-left: auto;">
		<li class="nav-item">
		<a class="nav-link" href="https://www.fun123.cn/reference/">首页</a>
		</li>
	    <li class="nav-item dropdown">
		<a class="nav-link" href="https://www.fun123.cn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		    关于我们
		</a>
		<div class="dropdown-menu">
		    <a class="dropdown-item" href="https://www.fun123.cn/reference/info/about-us.html?f=ref">关于我们</a>
			<a class="dropdown-item" href="https://www.fun123.cn/reference/info/ReleaseNotes.html?f=ref" target="_blank">发布日志</a>
			<a class="dropdown-item" href="https://www.fun123.cn/Ya_tos_form.html?f=ref" target="_blank">服务条款</a>
		</div>
	    </li>
	    <li class="nav-item dropdown">
		<a class="nav-link" href="https://www.fun123.cn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		    教育
		</a>
		<div class="dropdown-menu">
			<a class="dropdown-item" href="https://www.fun123.cn/reference/info/?f=ref#AppEntry" target="_blank">项目指南</a>
		    <a class="dropdown-item" href="https://bbs.tsingfun.com/forum-147-1.html?f=ref" target="_blank">中文论坛</a>
		    <a class="dropdown-item" href="https://www.fun123.cn/reference/tutorials?f=ref">中文教程</a>
		</div>
	    </li>
		<li class="nav-item dropdown">
		<a class="nav-link" href="https://www.fun123.cn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
			反馈
		</a>
		<div class="dropdown-menu">
			<a class="dropdown-item" href="https://support.qq.com/products/514085" target="_blank">我要反馈</a>
		</div>
		</li>
    </ul>
        <div style="display: inline-flex;margin-left:auto;margin-right:0">
				<script>
					var _hmt = _hmt || [];
					(function() {
					  var hm = document.createElement("script");
					  hm.src = "https://hm.baidu.com/hm.js?8d287b854d737bdc880e8ddeac1b309d";
					  var s = document.getElementsByTagName("script")[0]; 
					  s.parentNode.insertBefore(hm, s);
					})();
				</script>
        </div>
	<!-- <form class="form-inline" action="/action_page.php">
	     <div class="form-group has-search">
	     <span class="fa fa-search form-control-feedback"></span>
	     <input type="text" class="form-control" placeholder="Search">
	     </div>
	     </form> -->
    </div>
	<div class="collapse navbar-collapse">
		<img src="/static/images/hello.png" alt="你好">
	</div>
</nav>
<div class="default-page">
            <div class="header">
	        <h1 class="font-weight-bold text-center offset-xl-2 col-xl-8">App Inventor 2 如何连接MySQL数据库（阿里云数据库）</h1>
            </div>
            <div class="container-fluid">
                <article class="documentation">
<ul id="markdown-toc">
  <li><a href="#app-inventor-2-如何连接mysql数据库" id="markdown-toc-app-inventor-2-如何连接mysql数据库">App Inventor 2 如何连接MySQL数据库</a>    <ul>
      <li><a href="#开发步骤" id="markdown-toc-开发步骤">开发步骤</a></li>
    </ul>
  </li>
  <li><a href="#前端代码块" id="markdown-toc-前端代码块">前端代码块</a></li>
  <li><a href="#后端php代码" id="markdown-toc-后端php代码">后端php代码</a></li>
</ul>

<p><a href="index.html">« 返回首页</a></p>

<!--https://puravidaapps.com/mysql.php-->

<p>由于阿里数据库（Oceanbase）完全兼容 MySQL，因此这里探讨的就是怎么连MySQL。</p>

<h2 id="app-inventor-2-如何连接mysql数据库">App Inventor 2 如何连接MySQL数据库</h2>

<p>首先，App Inventor 2 并没有提供直接连接 MySQL 的方式，也没有现成的拓展。</p>

<p>经过官方资料查找，目前仅有的方案是利用  <code class="highlighter-rouge">Web客户端</code> 将你的查询请求 Post 到你自己的服务器，服务器提供 php 代码代理执行你的 sql 给 MySQL。</p>

<p>先看效果：</p>

<p><img src="mysql/mysql.png" alt="mysql" /></p>

<h3 id="开发步骤">开发步骤</h3>

<ol>
  <li>将 PHP 代码放在 Web 服务器上</li>
  <li>在应用和 PHP 代码中设置 SQLKEY，它们必须匹配才能使此代码正常工作，以保障安全（注意：请不要使用特殊字符）</li>
  <li>在 php 脚本中设置数据库连接信息</li>
  <li>测试代码</li>
</ol>

<p><strong>注意事项：</strong></p>
<ul>
  <li>返回 HTTP 代码 200 表示SELECT 查询成功</li>
  <li>返回 HTTP 代码 201 表示不是有效的 SELECT 查询</li>
  <li>返回 HTTP 代码 400，表示 SQL 查询错误</li>
  <li>请注意SQL注入风险，加强php代码的检查逻辑</li>
</ul>

<h2 id="前端代码块">前端代码块</h2>

<p>执行sql语句的代码块，参考如下：</p>

<p><img src="mysql/runQuery.png" alt="runQuery" /></p>

<p>服务器响应处理代码块，参考如下：</p>

<p><img src="mysql/onResponse.png" alt="onResponse" /></p>

<p>.aia源码下载：</p>

<p class="vip"><a href="mysql/mysql.aia">mysql.aia</a></p>

<h2 id="后端php代码">后端php代码</h2>

<p>php参考代码如下：</p>

<div class="language-php vip highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="cm">/*
 * Written By: ShivalWolf
 * Date: 2011/06/03
 * Contact: Shivalwolf@domwolf.net
 *
 * UPDATE 2011/04/05
 * The code now returns a real error message on a bad query with the mysql error number and its error message
 * checks for magic_quotes being enabled and strips slashes if it is. Its best to disable magic quotes still.
 * Checks to make sure the submitted form is a x-www-form-urlencode just so people dont screw with a browser access or atleast try to
 * Forces the output filename to be JSON to conform with standards
 *
 * UPDATE 2011/06/03
 * Code updated to use the Web Module instead of tinywebdb
 *
 * UPDATE 2013/12/26 and 2014/02/18
 * minor modifications by Taifun, puravidaapps.com
 *
 * UPDATE 2014/07/11
 * mysql API (deprecated) replaced by mysqli by Taifun
 *
 * UPDATE 2015/04/30
 * SELECT logic adjusted (result stored in temp. file removed) by Taifun
 *
 * UPDATE 2016/02/21
 * Bugfix Undefined variable: csv
 */</span>

<span class="sd">/************************************CONFIG****************************************/</span>
<span class="c1">//DATABSE DETAILS//</span>
<span class="nv">$DB_ADDRESS</span><span class="o">=</span><span class="s2">""</span><span class="p">;</span>
<span class="nv">$DB_USER</span><span class="o">=</span><span class="s2">""</span><span class="p">;</span>
<span class="nv">$DB_PASS</span><span class="o">=</span><span class="s2">""</span><span class="p">;</span>
<span class="nv">$DB_NAME</span><span class="o">=</span><span class="s2">""</span><span class="p">;</span>

<span class="c1">//SETTINGS//</span>
<span class="c1">//This code is something you set in the APP so random people cant use it.</span>
<span class="nv">$SQLKEY</span><span class="o">=</span><span class="s2">"secret"</span><span class="p">;</span>

<span class="sd">/************************************CONFIG****************************************/</span>

<span class="c1">//these are just in case setting headers forcing it to always expire</span>
<span class="nb">header</span><span class="p">(</span><span class="s1">'Cache-Control: no-cache, must-revalidate'</span><span class="p">);</span>

<span class="nb">error_log</span><span class="p">(</span><span class="nb">print_r</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">,</span><span class="k">TRUE</span><span class="p">));</span>

<span class="k">if</span><span class="p">(</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'query'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'key'</span><span class="p">])</span> <span class="p">){</span>                                   <span class="c1">//checks if the tag post is there and if its been a proper form post</span>
  <span class="c1">//set content type to CSV (to be set here to be able to access this page also with a browser)</span>
  <span class="nb">header</span><span class="p">(</span><span class="s1">'Content-type: text/csv'</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'key'</span><span class="p">]</span><span class="o">==</span><span class="nv">$SQLKEY</span><span class="p">){</span>                                                           <span class="c1">//validates the SQL key</span>
    <span class="nv">$query</span><span class="o">=</span><span class="nb">urldecode</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'query'</span><span class="p">]);</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">get_magic_quotes_gpc</span><span class="p">()){</span>     <span class="c1">//check if the worthless pile of crap magic quotes is enabled and if it is, strip the slashes from the query</span>
      <span class="nv">$query</span><span class="o">=</span><span class="nb">stripslashes</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nv">$conn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mysqli</span><span class="p">(</span><span class="nv">$DB_ADDRESS</span><span class="p">,</span><span class="nv">$DB_USER</span><span class="p">,</span><span class="nv">$DB_PASS</span><span class="p">,</span><span class="nv">$DB_NAME</span><span class="p">);</span>    <span class="c1">//connect</span>

    <span class="k">if</span><span class="p">(</span><span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">connect_error</span><span class="p">){</span>                                                           <span class="c1">//checks connection</span>
      <span class="nb">header</span><span class="p">(</span><span class="s2">"HTTP/1.0 400 Bad Request"</span><span class="p">);</span>
      <span class="k">echo</span> <span class="s2">"ERROR Database Connection Failed: "</span> <span class="o">.</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">connect_error</span><span class="p">,</span> <span class="nx">E_USER_ERROR</span><span class="p">;</span>   <span class="c1">//reports a DB connection failure</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nv">$result</span><span class="o">=</span><span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>                                                     <span class="c1">//runs the posted query</span>
      <span class="k">if</span><span class="p">(</span><span class="nv">$result</span> <span class="o">===</span> <span class="kc">false</span><span class="p">){</span>
        <span class="nb">header</span><span class="p">(</span><span class="s2">"HTTP/1.0 400 Bad Request"</span><span class="p">);</span>                                             <span class="c1">//sends back a bad request error</span>
        <span class="k">echo</span> <span class="s2">"Wrong SQL: "</span> <span class="o">.</span> <span class="nv">$query</span> <span class="o">.</span> <span class="s2">" Error: "</span> <span class="o">.</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">,</span> <span class="nx">E_USER_ERROR</span><span class="p">;</span>          <span class="c1">//errors if the query is bad and spits the error back to the client</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nb">stristr</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span><span class="s2">"SELECT"</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>                                       <span class="c1">//tests if it's a SELECT statement</span>
          <span class="nv">$csv</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>                                                                    <span class="c1">// bug fix Undefined variable: csv</span>
          <span class="k">while</span> <span class="p">(</span><span class="nv">$fieldinfo</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">fetch_field</span><span class="p">())</span> <span class="p">{</span>
            <span class="nv">$csv</span> <span class="o">.=</span> <span class="nv">$fieldinfo</span><span class="o">-&gt;</span><span class="na">name</span><span class="o">.</span><span class="s2">","</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="nv">$csv</span> <span class="o">=</span> <span class="nb">rtrim</span><span class="p">(</span><span class="nv">$csv</span><span class="p">,</span> <span class="s2">","</span><span class="p">)</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
          <span class="k">echo</span> <span class="nv">$csv</span><span class="p">;</span>                                                                    <span class="c1">//prints header row</span>
          <span class="nv">$csv</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>

          <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">data_seek</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
          <span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">fetch_assoc</span><span class="p">()){</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$row</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
              <span class="nv">$csv</span> <span class="o">.=</span> <span class="nv">$value</span><span class="o">.</span><span class="s2">","</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nv">$csv</span> <span class="o">=</span> <span class="nb">rtrim</span><span class="p">(</span><span class="nv">$csv</span><span class="p">,</span> <span class="s2">","</span><span class="p">)</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">echo</span> <span class="nv">$csv</span><span class="p">;</span>                                                                    <span class="c1">//prints all data rows</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nb">header</span><span class="p">(</span><span class="s2">"HTTP/1.0 201 Rows"</span><span class="p">);</span>
          <span class="k">echo</span> <span class="s2">"AFFECTED ROWS: "</span> <span class="o">.</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">affected_rows</span><span class="p">;</span>       <span class="c1">//if the query is anything but a SELECT, it will return the number of affected rows</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>                                          <span class="c1">//closes the DB</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="nb">header</span><span class="p">(</span><span class="s2">"HTTP/1.0 400 Bad Request"</span><span class="p">);</span>
     <span class="k">echo</span> <span class="s2">"Bad Request"</span><span class="p">;</span>                                       <span class="c1">//reports if the secret key was bad</span>
  <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nb">header</span><span class="p">(</span><span class="s2">"HTTP/1.0 400 Bad Request"</span><span class="p">);</span>
        <span class="k">echo</span> <span class="s2">"Bad Request"</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>


</article>

            </div>
            <div class="cndns-right">
	<div class="cndns-right-menu menu-common" style="display:none" id="float_menu_btn">
		<a href="javascript:HideORDispMenu();" class="cndns-right-btn">
			<span class="fa fa-bars"></span>
			<p>
				切换<br />
				目录
			</p>
		</a>
	</div>
	<div class="cndns-right-menu menu-common">
		<a href="javascript:" class="cndns-right-btn">
			<span class="fa fa-qrcode"></span>
			<p>
				关注<br />
				我们
			</p>
		</a>
		<div class="cndns-right-box">
			<div class="box-border">
				<div class="sev-t">
					<img src="/static/images/weixin.jpg" />
					<i>关注我，不迷路</i>
				</div>
				<span class="arrow-right"></span>
			</div>
		</div>
	</div>
	<div class="cndns-right-menu menu-common">
		<a href="javascript:" class="cndns-right-btn">
			<span class="fa fa-wechat"></span>
			<p>
				技术<br />
				支持
			</p>
		</a>
		<div class="cndns-right-box">
			<div class="box-border">
				<div class="sev-t">
					<img src="/static/images/weixin.png" />
					<i>有技术难题，加我！</i>
				</div>
				<span class="arrow-right"></span>
			</div>
		</div>
	</div>
	<div class="cndns-right-menu menu-top" style="display:none" id="float_scrolltop">
		<a href="javascript:scroll2Top();" class="cndns-right-btn">
			<span class="fa fa-angle-up"></span>
			<i>顶部</i>
		</a>
	</div>
</div>

<div class="footer background-green">
    <div class="row container">
	<div class="col-xl-3">
	    <h4>App Inventor 2 中文网</h4>
	    <!-- <form class="form-inline" action="/action_page.php">
		 <div class="form-group has-search">
		 <span class="fa fa-search form-control-feedback"></span>
		 <input type="text" class="form-control" placeholder="Search">
		 </div>
		 </form> -->
	</div>
	<div class="col-xl-6 legal text-center">
	    <ul>
		<li>
		    <a href="https://www.fun123.cn" class="btn btn-link" role="button" target="_blank">© 2023 跟着学（上海）教育科技有限公司</a>
		</li>
		<li>
		    <a class="btn btn-link" role="button">版权所有，未经书面许可，不得转载或使用</a>
		</li>
		<li>
		    <a href="https://www.fun123.cn/Ya_tos_form.html?f=refb"
                       target="_blank" class="btn btn-link" role="button">隐私策略和使用条款</a>
		</li>
	    </ul>
	</div>
	<div class="col-xl-3 links">
		<a href="https://bbs.tsingfun.com/forum-147-1.html" target="_blank">技术支持</a><br>
		<a href="mailto:service@fun123.cn">service@fun123.cn</a>
	</div>

    </div>
</div>

</div>
    </body>
</html>
