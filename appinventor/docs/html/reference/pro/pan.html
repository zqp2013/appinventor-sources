<!DOCTYPE html>
<html lang="zh_CN"><!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>App Inventor 2 接入百度网盘API · App Inventor 2 中文网</title>
    <meta name="keywords" content="App Inventor 2 中文网,参考文档,App Inventor 2中文网,app inventor中文官网,appinventor网页版,appinventor2网站,appinventor官网,APPinventor2网页最新版,app inventor2中文官网,appinventor2 汉化,搭建appinventor2服务器,app inventor2 论坛,AppInventor,App Inventor,App Inventor 2,AI2中文网,AI2 中文网,ai2,少儿编程,青少年编程">
	<meta name="description" content="App Inventor 2 中文网参考文档，App Inventor 2 接入百度网盘API，百度网盘开放平台接入，百度网盘文件下载，文件上传。">
	<meta name="application-name" content="App Inventor 2 中文网"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="/static/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
    <link href="/static/css/fonts.css" rel="stylesheet">
    <link href="/static/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="/static/css/mit_app_inventor.css?1">
    <link rel="stylesheet" type="text/css" href="/static/css/materialdesignicons.min.css">
    <link rel="stylesheet" type="text/css" href="/static/css/docs.css?2">
    <link rel="stylesheet" type="text/css" href="/static/css/prism.css">
    <script src="/static/js/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="/static/js/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="/static/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="/static/js/docs.js?2" crossorigin="anonymous"></script>
    <script src="/static/js/prism.js" crossorigin="anonymous"></script>
    <script type="text/javascript">
     <!--//--><![CDATA[// ><!--

                                   var gotoappinventor = function() {
                                       var referrer = document.location.pathname;
                                       var patt = /.*hour-of-code.*/;
                                       if (referrer.match(patt)) {
                                           window.open("http://code.appinventor.mit.edu/", "new");
                                       } else {
                                           window.open("https://www.fun123.cn/", "new");
                                       }
                                   }
     //--><!]]>
    </script><!-- Hotjar Tracking Code for https://www.fun123.cn -->
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:3792684,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
</head>
<body class="mit_app_inventor"><nav class="navbar navbar-expand-xl navbar-light">
    <a class="navbar-brand" href="https://www.fun123.cn/">
	<img src="/static/images/logo.png" alt="Logo" style="height:72px;">
    </a>
    <button type="button" class="btn create-btn" style="margin-right: 20px;" onclick="gotoappinventor();">创建 Apps</button>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarContent"
            aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle Navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarContent">
	<ul class="navbar-nav" style="margin-left: auto;">
		<li class="nav-item">
		<a class="nav-link" href="https://www.fun123.cn/reference/">首页</a>
		</li>
	    <li class="nav-item dropdown">
		<a class="nav-link" href="https://www.fun123.cn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		    关于我们
		</a>
		<div class="dropdown-menu">
		    <a class="dropdown-item" href="https://www.fun123.cn/reference/info/about-us.html?f=ref">关于我们</a>
			<a class="dropdown-item" href="https://www.fun123.cn/reference/info/ReleaseNotes.html?f=ref" target="_blank">发布日志</a>
			<a class="dropdown-item" href="https://www.fun123.cn/Ya_tos_form.html?f=ref" target="_blank">服务条款</a>
		</div>
	    </li>
	    <li class="nav-item dropdown">
		<a class="nav-link" href="https://www.fun123.cn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		    教育
		</a>
		<div class="dropdown-menu">
			<a class="dropdown-item" href="https://www.fun123.cn/reference/info/?f=ref#AppEntry" target="_blank">项目指南</a>
		    <a class="dropdown-item" href="https://bbs.tsingfun.com/forum-147-1.html?f=ref" target="_blank">中文论坛</a>
		    <a class="dropdown-item" href="https://www.fun123.cn/reference/tutorials?f=ref">中文教程</a>
		</div>
	    </li>
		<li class="nav-item dropdown">
		<a class="nav-link" href="https://www.fun123.cn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
			反馈
		</a>
		<div class="dropdown-menu">
			<a class="dropdown-item" href="https://support.qq.com/products/514085" target="_blank">我要反馈</a>
		</div>
		</li>
    </ul>
        <div style="display: inline-flex;margin-left:auto;margin-right:0">
				<script>
					var _hmt = _hmt || [];
					(function() {
					  var hm = document.createElement("script");
					  hm.src = "https://hm.baidu.com/hm.js?8d287b854d737bdc880e8ddeac1b309d";
					  var s = document.getElementsByTagName("script")[0]; 
					  s.parentNode.insertBefore(hm, s);
					})();
				</script>
        </div>
	<!-- <form class="form-inline" action="/action_page.php">
	     <div class="form-group has-search">
	     <span class="fa fa-search form-control-feedback"></span>
	     <input type="text" class="form-control" placeholder="Search">
	     </div>
	     </form> -->
    </div>
	<div class="collapse navbar-collapse">
		<img src="/static/images/hello.png" alt="你好">
	</div>
</nav>
<div class="default-page">
            <div class="header">
	        <h1 class="font-weight-bold text-center offset-xl-2 col-xl-8">App Inventor 2 接入百度网盘API</h1>
            </div>
            <div class="container-fluid">
                <article class="documentation">
<ul id="markdown-toc">
  <li><a href="#app-inventor-2-接入百度网盘api文件下载" id="markdown-toc-app-inventor-2-接入百度网盘api文件下载">App Inventor 2 接入百度网盘API：文件下载</a>    <ul>
      <li><a href="#1申请应用" id="markdown-toc-1申请应用">1、申请应用</a></li>
      <li><a href="#2用户登录认证拿到access_token后续请求必备参数-使用web浏览框" id="markdown-toc-2用户登录认证拿到access_token后续请求必备参数-使用web浏览框">2、用户登录认证，拿到access_token，后续请求必备参数 【使用Web浏览框】</a></li>
      <li><a href="#3获取文件列表返回json拿出想要的文件的fsid-使用web客户端" id="markdown-toc-3获取文件列表返回json拿出想要的文件的fsid-使用web客户端">3、获取文件列表，返回JSON，拿出想要的文件的fsid 【使用Web客户端】</a></li>
      <li><a href="#4获取文件信息返回json根据fsid取出dlink-使用web客户端" id="markdown-toc-4获取文件信息返回json根据fsid取出dlink-使用web客户端">4、获取文件信息，返回JSON，根据fsid取出dlink 【使用Web客户端】</a></li>
      <li><a href="#5根据dlink下载-web客户端" id="markdown-toc-5根据dlink下载-web客户端">5、根据dlink下载 【Web客户端】</a></li>
      <li><a href="#6下载效果展示" id="markdown-toc-6下载效果展示">6、下载效果展示</a></li>
    </ul>
  </li>
  <li><a href="#app-inventor-2-接入百度网盘api文件上传" id="markdown-toc-app-inventor-2-接入百度网盘api文件上传">App Inventor 2 接入百度网盘API：文件上传</a>    <ul>
      <li><a href="#3预上传" id="markdown-toc-3预上传">3、预上传</a></li>
      <li><a href="#4文件上传" id="markdown-toc-4文件上传">4、文件上传</a></li>
    </ul>
  </li>
</ul>

<p><a href="index.html">« 返回首页</a></p>

<h2 id="app-inventor-2-接入百度网盘api文件下载">App Inventor 2 接入百度网盘API：文件下载</h2>

<h3 id="1申请应用">1、<a href="https://pan.baidu.com/union/doc/fl0hhnulu">申请应用</a></h3>

<p>AppID [AppID]</p>

<p>AppKey [AppKey]</p>

<p>Secretkey [暂时用不到]</p>

<p>Signkey [暂时用不到]</p>

<hr />
<h3 id="2用户登录认证拿到access_token后续请求必备参数-使用web浏览框">2、用户登录认证，拿到access_token，后续请求必备参数 【使用Web浏览框】</h3>

<p><a href="https://pan.baidu.com/union/document/basic">接入文档</a></p>

<p>使用Web浏览框，里面要输入网盘用户名密码，成功后返回的url中拿出access_token</p>

<p>这里使用<a href="https://pan.baidu.com/union/doc/6l0ryrjzv"><code class="highlighter-rouge">简单模式</code></a>，回调网页，在回调后的URL中拿出access_token，后面操作都需要它：</p>

<blockquote>
  <p>http://openapi.baidu.com/oauth/2.0/authorize?display=mobile&amp;response_type=token&amp;client_id=[AppKey]&amp;redirect_uri=oob&amp;scope=basic,netdisk</p>
</blockquote>

<p><strong>请注意</strong>：手机的话，必须将 <code class="highlighter-rouge">display=mobile</code> 加上，以展示手机版的授权画面（电脑版极有可能在手机上不能完美展示）。</p>

<p>access_token=[access_token]    有效期：根据文档，有效期大概30天</p>

<p>拿 access_token 的逻辑如下：</p>

<p><img src="images/获取access_token.png" alt="获取access_token" class="vip" /></p>

<hr />
<h3 id="3获取文件列表返回json拿出想要的文件的fsid-使用web客户端">3、获取文件列表，返回JSON，拿出想要的文件的fsid 【使用Web客户端】</h3>

<blockquote>
  <p>https://pan.baidu.com/rest/2.0/xpan/file?method=list&amp;dir=/test&amp;order=time&amp;start=0&amp;limit=10&amp;web=web&amp;folder=0&amp;access_token=[access_token]&amp;desc=1</p>
</blockquote>

<p>参考代码如下：</p>

<p><img src="images/获取文件fs_id.png" alt="获取文件fs_id" class="vip" /></p>

<p><strong>注意</strong>：这里是限定显示第一页，每页 10 条，可以改请求参数拿更多的文件：<code class="highlighter-rouge">start=0&amp;limit=10</code>，比如10改为1000等。</p>

<hr />
<h3 id="4获取文件信息返回json根据fsid取出dlink-使用web客户端">4、获取文件信息，返回JSON，根据fsid取出dlink 【使用Web客户端】</h3>

<blockquote>
  <p>http://pan.baidu.com/rest/2.0/xpan/multimedia?access_token=[access_token]&amp;method=filemetas&amp;fsids=[1737895653506]&amp;thumb=1&amp;dlink=1&amp;extra=1</p>
</blockquote>

<p><img src="images/获取文件下载地址dlink.png" alt="获取文件下载地址dlink" class="vip" /></p>

<hr />
<h3 id="5根据dlink下载-web客户端">5、根据dlink下载 【Web客户端】</h3>

<blockquote>
  <p>https://d.pcs.baidu.com/file/330eb0451pf47ab8514ab5b6f0095c67?fid=2584198580-250528-1737895653506&amp;rt=pr&amp;sign=FDtAERV-DCb740ccc5511e5e8fedcff06b081203-l1%2FQEmhrWYz44QzUHHhKQpLLZfk%3D&amp;expires=8h&amp;chkbd=0&amp;chkv=3&amp;dp-logid=2874731127723614236&amp;dp-callid=0&amp;dstime=1697013275&amp;r=649469325&amp;origin_appid=[AppID]&amp;file_type=0</p>
</blockquote>

<p>注意：这个dlink可以在浏览器中直接访问，下载。但是如果使用Web客户端的话，会响应 302 错误。</p>

<p>这是由于这个dlink是一个302跳转，要再次跳转到实际下载地址，这里考虑使用类似点击链接的方式，下载文件，测试可用。</p>

<p>参考代码如下：</p>

<p><img src="images/文件dlink下载.png" alt="文件dlink下载" class="vip" /></p>

<!--注意：dlink中需转义   \u0026  ->  &-->

<h3 id="6下载效果展示">6、下载效果展示</h3>

<p><img src="images/百度网盘文件下载效果.png" alt="百度网盘文件下载效果" /></p>

<h2 id="app-inventor-2-接入百度网盘api文件上传">App Inventor 2 接入百度网盘API：文件上传</h2>

<p>申请应用及拿 access_token 同下载篇的步骤1 及 步骤2，必备步骤。</p>

<hr />
<h3 id="3预上传">3、预上传</h3>

<blockquote>
  <p>http://pan.baidu.com/rest/2.0/xpan/file?method=precreate&amp;access_token=[access_token]&amp;path=/apps/appName/filename.jpg&amp;size=2626327&amp;isdir=0&amp;autoinit=1&amp;rtype=3&amp;block_list=[“60bac7b6464d84fed842955e6126826a”]&amp;content-md5=60bac7b6464d84fed842955e6126826a&amp;slice-md5=3c5c864d432cc2381b687f8d873e1429</p>
</blockquote>

<div class="language-config highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rtype</span>	<span class="n">int</span>	 文件命名策略，默认<span class="m">0</span>
<span class="m">0</span> 为不重命名，返回冲突
<span class="m">1</span> 为只要<span class="n">path</span>冲突即重命名
<span class="m">2</span> 为<span class="n">path</span>冲突且<span class="n">block_list</span>不同才重命名
<span class="m">3</span> 为覆盖
</code></pre></div></div>

<h3 id="4文件上传">4、文件上传</h3>

<blockquote>
  <p>curl -F ‘file=@/Downloads/filename.jpg’ “https://d.pcs.baidu.com/rest/2.0/pcs/superfile2?method=upload&amp;type=tmpfile&amp;path=/apps/AppName/filename.jpg&amp;partseq=0&amp;access_token=&amp;uploadid=”</p>
</blockquote>

<p><img src="images/百度网盘文件上传出错.png" alt="百度网盘文件上传出错" /></p>

<p>上传，发现 <code class="highlighter-rouge">Transfer-Encoding</code> 永远都是<code class="highlighter-rouge">trunked</code>，改了也无效，<code class="highlighter-rouge">Content-Length</code>也无法指定，导致百度网盘拒绝了我们的请求：<strong>Transfer-Encoding can’t be trunked.</strong></p>

<p>而采用python或php自己写一个简单服务端是可以接受上传的文件的。</p>

<p>采用图片base64方案，也只能自己写服务端，然后解码，恢复文件，百度网盘也无法采用这种方案。</p>

<p><strong>直接用python或curl命令测试下来，是一点问题都没有</strong>，就 App Inventor 2 搞不定，只能说ai2可发挥空间有限，默认采用了trunked协议，无法指定HTTP1.0，设置请求标头也修改不了，百度网盘把这个拦住了，<strong>直接上传百度网盘的方案行不通</strong>。</p>

<p>考虑换方案：</p>

<p>1、用php/python写一个中转的服务端，服务端使用curl上传百度网盘，是可以完成的。</p>

<p>2、改用自己的服务器接收图片，用php/python写一个简单的服务端，Web客户端POST文件到自己的服务器，代码请参考<a href="file_upload.html">《App Inventor 2 实现上传文件到服务器全方案总结》</a>。</p>

<p>3、考虑自己写一个拓展，使用java完成网盘接入。</p>

<p>坑已经帮你踩了，剩下的就靠你自己了^_^</p>

</article>

            </div>
            <div class="cndns-right">
	<div class="cndns-right-menu menu-common" style="display:none" id="float_menu_btn">
		<a href="javascript:HideORDispMenu();" class="cndns-right-btn">
			<span class="fa fa-bars"></span>
			<p>
				切换<br />
				目录
			</p>
		</a>
	</div>
	<div class="cndns-right-menu menu-common">
		<a href="javascript:" class="cndns-right-btn">
			<span class="fa fa-qrcode"></span>
			<p>
				关注<br />
				我们
			</p>
		</a>
		<div class="cndns-right-box">
			<div class="box-border">
				<div class="sev-t">
					<img src="/static/images/weixin.jpg" />
					<i>关注我，不迷路</i>
				</div>
				<span class="arrow-right"></span>
			</div>
		</div>
	</div>
	<div class="cndns-right-menu menu-common">
		<a href="javascript:" class="cndns-right-btn">
			<span class="fa fa-wechat"></span>
			<p>
				技术<br />
				支持
			</p>
		</a>
		<div class="cndns-right-box">
			<div class="box-border">
				<div class="sev-t">
					<img src="/static/images/weixin.png" />
					<i>有技术难题，加我！</i>
				</div>
				<span class="arrow-right"></span>
			</div>
		</div>
	</div>
	<div class="cndns-right-menu menu-top" style="display:none" id="float_scrolltop">
		<a href="javascript:scroll2Top();" class="cndns-right-btn">
			<span class="fa fa-angle-up"></span>
			<i>顶部</i>
		</a>
	</div>
</div>

<div class="footer background-green">
    <div class="row container">
	<div class="col-xl-3">
	    <h4>App Inventor 2 中文网</h4>
	    <!-- <form class="form-inline" action="/action_page.php">
		 <div class="form-group has-search">
		 <span class="fa fa-search form-control-feedback"></span>
		 <input type="text" class="form-control" placeholder="Search">
		 </div>
		 </form> -->
	</div>
	<div class="col-xl-6 legal text-center">
	    <ul>
		<li>
		    <a href="https://www.fun123.cn" class="btn btn-link" role="button" target="_blank">© 2023 跟着学（上海）教育科技有限公司</a>
		</li>
		<li>
		    <a class="btn btn-link" role="button">版权所有，未经书面许可，不得转载或使用</a>
		</li>
		<li>
		    <a href="https://www.fun123.cn/Ya_tos_form.html?f=refb"
                       target="_blank" class="btn btn-link" role="button">隐私策略和使用条款</a>
		</li>
	    </ul>
	</div>
	<div class="col-xl-3 links">
		<a href="https://bbs.tsingfun.com/forum-147-1.html" target="_blank">技术支持</a><br>
		<a href="mailto:service@fun123.cn">service@fun123.cn</a>
	</div>

    </div>
</div>

</div>
    </body>
</html>
